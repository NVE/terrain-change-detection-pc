# Default configuration (in-memory by default)
#
# Use this as a starting point. For large datasets that do not fit in memory,
# switch to an out-of-core profile (e.g., config/profiles/large_scale.yaml) or
# enable the outofcore section here.

paths:
  # Root folder containing your datasets
  base_dir: data/raw

preprocessing:
  # If true, keep only LAS class 2 (ground) unless classification_filter is set
  ground_only: true
  # Optional list of LAS classification codes to include; overrides ground_only
  classification_filter: [2]

discovery:
  # Subdirectory names used when discovering datasets under base_dir
  data_dir_name: data
  metadata_dir_name: metadata

alignment:
  # ICP/registration parameters
  max_iterations: 100
  tolerance: 1.0e-6
  max_correspondence_distance: 1.0
  # Number of points sampled per epoch for alignment (approx.)
  subsample_size: 50000
  coarse:
    enabled: true
    # Coarse alignment method: centroid | pca | phase | open3d_fpfh | none
    method: phase
    # Voxel size (m) for coarse features/downsampling
    voxel_size: 2.0
    # Cell size (m) for phase correlation grid
    phase_grid_cell: 2.0

detection:
  dod:
    enabled: false
    # DEM grid resolution in meters
    cell_size: 1.0
    # Aggregation for per-cell elevation: mean | median | p95 | p5
    aggregator: mean
  c2c:
    enabled: false
    # Algorithm: euclidean | vertical_plane
    mode: euclidean
    # Upper bound used by some example flows for sampling/limits
    max_points: 10000
    # Search radius (m). Required for streaming C2C; null may imply in-memory.
    max_distance: null
    # Local modeling parameters (for mode=vertical_plane)
    radius: null
    k_neighbors: 20
    min_neighbors: 6
  m3c2:
    enabled: false
    # Number of core points at which to compute M3C2 distances
    core_points: 10000
    autotune:
      # Target neighbor count for choosing scales
      target_neighbors: 16
      # Half-depth along normal as a fraction of cylinder radius
      max_depth_factor: 0.6
      # Min/max search radii (m) for scale selection
      min_radius: 1.0
      max_radius: 20.0
    ep:
      # Number of worker processes/threads; null = OS default
      workers: null

visualization:
  # plotly | pyvista | pyvistaqt
  backend: plotly
  # Max points to draw for interactive views
  sample_size: 50000

logging:
  level: INFO
  # Path to log file; null = stdout only
  file: null

performance:
  # Set to an integer to pin NumPy threads; 'auto' lets NumPy decide
  numpy_threads: auto

outofcore:
  # Master switch for streaming/tiling out-of-core workflows
  enabled: false
  # Inner tile size in meters (processing region per tile)
  tile_size_m: 500.0
  # Halo width in meters (buffer around each tile to avoid edge effects)
  halo_m: 20.0
  # Max points per streaming chunk (memory/performance trade-off)
  chunk_points: 1000000
  # Use streaming mode in preprocessing when out-of-core is enabled
  streaming_mode: true
  # Save transformed LAZ files during alignment to disk
  save_transformed_files: true
  # Output directory for transformed files; null = auto-generate
  output_dir: null
